let cart = JSON.parse(localStorage.getItem('coffeeCart')) || [];

function updateCartUI() {
    const cartCount = document.getElementById('cart-count');
    const cartItems = document.getElementById('cart-items');
    const cartTotal = document.getElementById('cart-total');
    
    if (cartCount) cartCount.innerText = cart.reduce((sum, item) => sum + item.quantity, 0);
    
    if (cartItems) {
        cartItems.innerHTML = '';
        let total = 0;
        cart.forEach((item, index) => {
            total += item.price * item.quantity;
            cartItems.innerHTML += `
                <div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
                    <div>
                        <strong>${item.name}</strong><br>
                        ${item.quantity} x ${item.price}€
                    </div>
                    <button onclick="removeFromCart(${index})" style="background:none; border:none; color:red; cursor:pointer;">Eliminar</button>
                </div>
            `;
        });
        if (cartTotal) cartTotal.innerText = total.toFixed(2);
    }
    localStorage.setItem('coffeeCart', JSON.stringify(cart));
}

function addToCart(id, name, price) {
    const existing = cart.find(item => item.id === id);
    if (existing) {
        existing.quantity += 1;
    } else {
        cart.push({ id, name, price, quantity: 1 });
    }
    updateCartUI();
    toggleCart(true); // Abre el carrito al añadir
}

function removeFromCart(index) {
    cart.splice(index, 1);
    updateCartUI();
}

function toggleCart(forceOpen = false) {
    const panel = document.getElementById('cart-panel');
    if (forceOpen) panel.classList.add('open');
    else panel.classList.toggle('open');
}

document.addEventListener('DOMContentLoaded', updateCartUI);
