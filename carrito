// 1. Cargar el carrito guardado o empezar uno vac√≠o
let cart = JSON.parse(localStorage.getItem('deepWorkCart')) || {};

// 2. FUNCI√ìN PARA DIBUJAR EL CARRITO (Aqu√≠ es donde se crean los botones + y -)
function updateUI() {
    const container = document.getElementById('cart-items');
    const countLabel = document.getElementById('cart-count');
    const totalLabel = document.getElementById('cart-total');
    
    if (!container || !countLabel || !totalLabel) return;

    container.innerHTML = '';
    let total = 0;
    let totalItems = 0;

    Object.keys(cart).forEach(id => {
        const item = cart[id];
        const subtotal = item.price * item.quantity;
        total += subtotal;
        totalItems += item.quantity;

        // Aqu√≠ creamos la estructura visual de cada fila del carrito
        container.innerHTML += `
            <div style="display:flex; justify-content:space-between; align-items:center; padding:15px 0; border-bottom:1px solid #eee;">
                <div style="flex:1;">
                    <strong style="display:block;">${item.name}</strong>
                    <small>${subtotal}‚Ç¨</small>
                </div>
                
                <div style="display:flex; align-items:center; gap:10px; background:#f0f0f0; padding:5px 10px; border-radius:20px;">
                    <button onclick="changeQty('${id}', -1)" style="border:none; background:none; cursor:pointer; font-weight:bold; width:20px;">-</button>
                    <span style="font-weight:bold; min-width:15px; text-align:center;">${item.quantity}</span>
                    <button onclick="changeQty('${id}', 1)" style="border:none; background:none; cursor:pointer; font-weight:bold; width:20px;">+</button>
                </div>

                <button onclick="removeItem('${id}')" style="background:none; border:none; color:red; cursor:pointer; margin-left:10px;">üóëÔ∏è</button>
            </div>`;
    });

    // Actualizar n√∫meros en la interfaz
    countLabel.innerText = totalItems;
    totalLabel.innerText = total;

    // GUARDAR EN LA MEMORIA DEL NAVEGADOR
    localStorage.setItem('deepWorkCart', JSON.stringify(cart));

    if (totalItems === 0) {
        container.innerHTML = '<p style="text-align:center; color:#888; margin-top:20px;">Tu carrito est√° vac√≠o</p>';
    }
}

// 3. FUNCI√ìN PARA A√ëADIR (Desde la p√°gina de caf√©s)
function addToCart(id, name, price) {
    const qtyInput = document.getElementById('qty-' + id);
    const quantityToAdd = qtyInput ? parseInt(qtyInput.value) : 1;

    if (cart[id]) {
        cart[id].quantity += quantityToAdd;
    } else {
        cart[id] = { name, price, quantity: quantityToAdd };
    }
    
    if(qtyInput) qtyInput.value = 1; // Resetear el selector de la tienda
    updateUI();
    document.getElementById('cart-panel').classList.add('open');
}

// 4. FUNCI√ìN PARA SUMAR/RESTAR (Dentro del carrito)
function changeQty(id, delta) {
    if (cart[id]) {
        cart[id].quantity += delta;
        // Si la cantidad llega a 0, lo borramos autom√°ticamente
        if (cart[id].quantity <= 0) {
            delete cart[id];
        }
        updateUI();
    }
}

// 5. FUNCI√ìN PARA ELIMINAR DE GOLPE
function removeItem(id) {
    delete cart[id];
    updateUI();
}

// 6. FUNCI√ìN PARA ABRIR/CERRAR EL PANEL
function toggleCart() {
    const panel = document.getElementById('cart-panel');
    if(panel) panel.classList.toggle('open');
}

// Ejecutar al cargar la p√°gina para que aparezca lo que ya estaba guardado
document.addEventListener('DOMContentLoaded', updateUI);
