// Cargar el carrito guardado o empezar uno vac√≠o
let cart = JSON.parse(localStorage.getItem('deepWorkCart')) || {};

// Funci√≥n para dibujar el carrito en el panel lateral
function updateUI() {
    const container = document.getElementById('cart-items');
    const countLabel = document.getElementById('cart-count');
    const totalLabel = document.getElementById('cart-total');
    
    // Si no encuentra los elementos del carrito, no hace nada (√∫til para p√°ginas sin carrito visible)
    if (!container || !countLabel || !totalLabel) return;

    container.innerHTML = ''; // Limpia el contenido actual del carrito
    let total = 0;
    let totalItems = 0;

    // Recorre cada producto en el carrito y lo dibuja
    Object.keys(cart).forEach(id => {
        const item = cart[id];
        const subtotal = item.price * item.quantity;
        total += subtotal;
        totalItems += item.quantity;

        container.innerHTML += `
            <div class="cart-item">
                <div class="cart-item-info">
                    <strong>${item.name}</strong>
                    <span>${item.price}‚Ç¨ / unidad</span>
                </div>
                
                <div class="cart-qty-controls">
                    <button class="qty-btn" onclick="changeQty('${id}', -1)">-</button>
                    <span class="qty-number">${item.quantity}</span>
                    <button class="qty-btn" onclick="changeQty('${id}', 1)">+</button>
                </div>

                <button class="delete-btn" onclick="removeItem('${id}')">üóëÔ∏è</button>
            </div>`;
    });

    // Actualiza los contadores de la interfaz
    countLabel.innerText = totalItems;
    totalLabel.innerText = total;

    // Guarda el carrito en LocalStorage para que persista
    localStorage.setItem('deepWorkCart', JSON.stringify(cart));

    // Mensaje si el carrito est√° vac√≠o
    if (totalItems === 0) {
        container.innerHTML = '<p style="text-align:center; color:#888; margin-top:30px;">Tu carrito est√° vac√≠o</p>';
    }
}

// Funci√≥n para a√±adir un producto al carrito
function addToCart(id, name, price) {
    const qtyInput = document.getElementById('qty-' + id);
    const btn = document.getElementById('btn-' + id);
    const quantity = qtyInput ? parseInt(qtyInput.value) : 1; // Obtiene la cantidad del input o 1 por defecto

    if (cart[id]) {
        cart[id].quantity += quantity;
    } else {
        cart[id] = { name, price, quantity };
    }
    
    // Animaci√≥n de feedback para el bot√≥n (si existe)
    if (btn) {
        const originalText = btn.innerText;
        btn.innerText = "¬°A√±adido! ‚úì";
        btn.classList.add('added');
        setTimeout(() => {
            btn.innerText = originalText;
            btn.classList.remove('added');
        }, 1000);
    }
    
    if(qtyInput) qtyInput.value = 1; // Resetear el selector de la tienda
    updateUI(); // Redibuja el carrito
    document.getElementById('cart-panel').classList.add('open'); // Abre el panel del carrito
}

// Funci√≥n para cambiar la cantidad de un producto en el carrito
function changeQty(id, delta) {
    if (cart[id]) {
        cart[id].quantity += delta;
        if (cart[id].quantity <= 0) { // Si la cantidad llega a 0 o menos, elimina el producto
            delete cart[id];
        }
        updateUI(); // Redibuja el carrito
    }
}

// Funci√≥n para eliminar un producto completo del carrito
function removeItem(id) {
    delete cart[id];
    updateUI(); // Redibuja el carrito
}

// Funci√≥n para abrir/cerrar el panel del carrito
function toggleCart() {
    const panel = document.getElementById('cart-panel');
    if(panel) panel.classList.toggle('open');
}

// Asegura que el carrito se dibuje al cargar la p√°gina
document.addEventListener('DOMContentLoaded', updateUI);
