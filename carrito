let cart = JSON.parse(localStorage.getItem('deepWorkCart')) || {};

function updateUI() {
    const container = document.getElementById('cart-items');
    const countLabel = document.getElementById('cart-count');
    const totalLabel = document.getElementById('cart-total');
    
    if (!container || !countLabel || !totalLabel) return;

    container.innerHTML = '';
    let total = 0;
    let totalItems = 0;

    Object.keys(cart).forEach(id => {
        const item = cart[id];
        const subtotal = item.price * item.quantity;
        total += subtotal;
        totalItems += item.quantity;

        // AQU√ç EST√ÅN LOS BOTONES + Y -
        container.innerHTML += `
            <div style="display:flex; justify-content:space-between; align-items:center; padding:15px 0; border-bottom:1px solid #eee;">
                <div style="flex:1;">
                    <strong style="display:block;">${item.name}</strong>
                    <small>${subtotal}‚Ç¨</small>
                </div>
                
                <div style="display:flex; align-items:center; gap:10px; background:#f0f0f0; padding:5px 10px; border-radius:20px;">
                    <button onclick="changeQty('${id}', -1)" style="border:none; background:none; cursor:pointer; font-weight:bold; width:20px;">-</button>
                    <span style="font-weight:bold;">${item.quantity}</span>
                    <button onclick="changeQty('${id}', 1)" style="border:none; background:none; cursor:pointer; font-weight:bold; width:20px;">+</button>
                </div>

                <button onclick="removeItem('${id}')" style="background:none; border:none; color:red; cursor:pointer; margin-left:10px;">üóëÔ∏è</button>
            </div>`;
    });

    countLabel.innerText = totalItems;
    totalLabel.innerText = total;
    localStorage.setItem('deepWorkCart', JSON.stringify(cart));

    if (totalItems === 0) {
        container.innerHTML = '<p style="text-align:center; color:#888; margin-top:20px;">Carrito vac√≠o</p>';
    }
}

function addToCart(id, name, price) {
    const qtyInput = document.getElementById('qty-' + id);
    const quantityToAdd = qtyInput ? parseInt(qtyInput.value) : 1;

    if (cart[id]) {
        cart[id].quantity += quantityToAdd;
    } else {
        cart[id] = { name, price, quantity: quantityToAdd };
    }
    
    if(qtyInput) qtyInput.value = 1;
    updateUI();
    document.getElementById('cart-panel').classList.add('open');
}

function changeQty(id, delta) {
    if (cart[id]) {
        cart[id].quantity += delta;
        if (cart[id].quantity <= 0) delete cart[id];
        updateUI();
    }
}

function removeItem(id) {
    delete cart[id];
    updateUI();
}

function toggleCart() {
    const panel = document.getElementById('cart-panel');
    if(panel) panel.classList.toggle('open');
}

document.addEventListener('DOMContentLoaded', updateUI);
